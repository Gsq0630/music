<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>share</title>
    <link href="css/main-gsq.css" rel=stylesheet>
    <link href="css/share.css" rel="stylesheet">
    <script src="js/jquery-3.4.1.js"></script>
    <script src="js/vue.min.js"></script>
    <script src="js/wangEditor.min.js"></script>
    <link href="css/wangEditor.css" rel="stylesheet">
    <script>
        $(function () {




            //Vue
            var bigBox = new Vue({
                el: "#mainBody",
                data: {
                    shares: [],
                    otherShareId:0,
                    shareText:""
                },
                methods: {
                    //搜索显示动态
                    toGetShares: function () {
                        $.ajax({
                            url: "/share/getAllShare",
                            datatype: "json",
                            type: "post",
                            success: function (data) {
                                for (var i = 0; i < data.length; i++)
                                    bigBox.shares.push({
                                        userName: data[i].userName,
                                        videoOrMusic: data[i].songUrl == null ? data[i].shareFromId == null ? "发布视频" : "转发动态" : "分享音乐",
                                        songUrl: data[i].songUrl,
                                        songName: data[i].songName,
                                        singerName: data[i].singerName,
                                        shareTime: data[i].shareTime,
                                        shareTitle: data[i].shareTitle,
                                        shareVideoTimes: data[i].shareVideoTimes,
                                        shareAnnexUrl: data[i].shareAnnexUrl,
                                        shareLocation: data[i].shareLocation,
                                        shareForwardCount: data[i].shareForwardCount,
                                        shareCommentCount: data[i].shareCommentCount,
                                        shareList: data[i].shareList,
                                        userHeadUrl: data[i].userHeadUrl,
                                        shareText: data[i].shareText,
                                        shareId: data[i].shareId,
                                        shareLikes: data[i].shareLikes,
                                        shareFromId:data[i].shareFromId
                                    })
                            }
                        })
                    },
                    //点赞功能
                    addLikes: function (index) {
                        $.ajax({
                            url: "/share/addLikes",
                            datatype: "json",
                            data: {"shareId": bigBox.shares[index].shareId},
                            type: "post",
                            success: function (data) {
                                bigBox.shares[index].shareLikes = bigBox.shares[index].shareLikes + 1;
                                // alert("dianzan")
                            },
                            error: function (data) {
                                // alert("dsa")
                            }
                        })
                        // alert(11)
                    },
                    addSonLikes: function (index, indexSon) {
                        $.ajax({
                            url: "/share/addLikes",
                            datatype: "json",
                            data: {"shareId": bigBox.shares[index].shareList[indexSon].shareId},
                            type: "post",
                            success: function (data) {
                                bigBox.shares[index].shareList[indexSon].shareLikes = bigBox.shares[index].shareList[indexSon].shareLikes + 1;
                                alert("dianzan")
                            },
                            error: function (data) {
                            }
                        })
                    },
                    shareForwardDivShow:function (index) {
                        if (bigBox.shares[index].shareFromId == null) {
                            var el = event.currentTarget;
                            bigBox.otherShareId = el.lastChild.innerHTML;
                            $("#shareOthersDiv").show();
                        }else{
                            alert("转发动态不能再次转发")
                        }
                    },
                    shareOtherDivHide:function () {
                        $("#shareOthersDiv").hide();
                    },
                    shareForwardBtn:function () {
                        $.ajax({
                            url:"share/shareForward",
                            type:"post",
                            datatype:"json",
                            data:{
                                shareText:bigBox.shareText,
                                shareFromId:bigBox.otherShareId,
                                userId:2
                            },
                            success:function () {
                                $("#shareOthersDiv").hide();
                                location.reload(true);
                            }
                        })
                    },
                    shareForwardCancel:function () {
                        $("#shareOthersDiv").hide();
                    }

                }
            });

            //wangEditor富文本编辑器
            var E = window.wangEditor;
            //这里的id为<div id="editor">中的id.
            var editor = new E('#editorPic', '#editorText');
            // var editor1 = new E('#div1', '#div2')  // 两个参数也可以传入 elem 对象，class 选择器
            // 配置服务器端地址,也就是servlet的请求路径，不带项目路径，前面没有/
            // editor.customConfig.uploadImgServer = 'uploadFile';
            editor.customConfig.uploadImgShowBase64 = true;
            editor.customConfig.uploadImgMaxSize = 3 * 1024 * 1024;
            editor.customConfig.menus = [
                'emoticon' // 表情

            ];
            editor.customConfig.onchange = function (html) {
                // // 监控变化，同步更新到 textarea
                // $("#show_box").html(html);
                // $("textarea").val(html);
            };
            //创建编辑器
            editor.create();

            var editor1 = new E('#editorForwardEmoji', '#editorForwardText');
            editor1.customConfig.menus = [
                'emoticon' // 表情

            ];
            editor1.customConfig.onchange = function (html) {
                bigBox.shareText = html ;
                // // 监控变化，同步更新到 textarea
                // $("#show_box").html(html);
                // $("textarea").val(html);
            };
            editor1.create();

            bigBox.toGetShares();

            $(".popWindow").hide();

        })


    </script>
</head>
<body>

<iframe src="head.html" frameborder="0" width="100%" height="71px" style="border-bottom: 30px #ffd700 solid"></iframe>
<div id="mainBody">


    <!--发布音乐动态-->
    <div class="popWindow" id="shareMusicDiv">
        <div class="popWindow-top">
            <div class="font-14 f-w-b f-c-e">分享</div>
            <div class="f-right"><a><i class="font-14 f-c-gold XXX">X</i></a></div>
        </div>
        <div class="share-text">
            <div class="u-txt area j-flag" placeholder="一起聊聊吧~" data-action="txt" id="editorText">

            </div>
            <div class="f-thide">
                <a>
                    <i style="padding: 5px 5px; display: block" class="f-left">
                        <img src="images/yuefu.png" height="30px"></i>
                    <span class="f-fs1 f-fl">给动态配上音乐</span>
                </a>
            </div>
        </div>

        <div class="f-tde">
            <div style="height: 30px; width: 40px;" id="editorPic" class="f-left"></div>
            <a href="#" style="display: block;padding: 5px 10px;" class="f-left">
                <i class="f-left">
                    <img src="images/Picture.png" height="15px">
                </i>
            </a>
        </div>

        <div style="padding-left: 40px"><img src="images/yuefu.png" height="100px"></div>

        <div class="btns">
            <a href="#">
                <div class="btn-share btn f-left" style="font-size: 16px">分享</div>
                <div class=" btn-share btn f-left btn-w" style="font-size: 16px">取消</div>
            </a>
        </div>


    </div>

    <!--转发动态-->
    <div class="popWindow" id="shareOthersDiv">
        <div class="popWindow-top">
            <div class="font-14 f-w-b f-c-e">转发动态</div>
            <div class="f-right"><a><i class="font-14 f-c-gold XXX" @click="shareOtherDivHide">X</i></a></div>
        </div>
        <div class="share-text">
            <div class="u-txt area j-flag" placeholder="一起聊聊吧~" data-action="txt" id="editorForwardText"></div>
        </div>

        <div class="f-tde">
            <div style="height: 30px; width: 40px;" id="editorForwardEmoji" class="f-left"></div>
        </div>

        <div class="btns">
            <a href="#">
                <div class="btn-share btn f-left" style="font-size: 16px" @click="shareForwardBtn">转发</div>
                <div class=" btn-share btn f-left btn-w" style="font-size: 16px" @click="shareForwardCancel">取消</div>
            </a>
        </div>


    </div>


    <div id="mB-left" class="f-left">
        <div id="left-top">
            <h3 class="f-left">动态</h3>
            <span class="f-right btn" id="shareMusicBtn"><a href="#" class="font-12"><img src="images/seX.png"
                                                                       height="16px">发布视频</a></span>
            <span class="f-right btn" id="shareVideoBtn"><a href="#" class="font-12"><img src="images/dTai.png"
                                                                       height="16px">发动态</a></span>
        </div>
        <div id="left-body">
            <ul>
                <!--动态-->
                <li v-for="(sh, index) in shares">
                    <div class="userPic f-left">
                        <a href="#">
                            <img :src="sh.userHeadUrl" height="45">
                        </a>
                    </div>
                    <div class="userShare f-left font-14 f-c-6">
                        <div class="type">
                            <a href="#" class="font-14">{{sh.userName}}</a>
                            <img src="images/V.png" height="11">
                            <span>{{sh.videoOrMusic}}</span>
                        </div>
                        <div class="time font-12">
                            <a href="#">{{sh.shareTime}}</a>
                        </div>
                        <div class="font-14 f-c-3 text" v-html="sh.shareText"></div>


                        <!--视频动态---播放视频时-->
                        <div class="video" v-if="sh.shareTitle != null">
                            <div>
                                <span style="padding-left: 150px;"><i><img src="images/share.png" height="10px"></i><a
                                        href="#">{{sh.shareTitle}}</a><a href="#"
                                                                         class="font-12"
                                                                         style="color:#aaa;"> - by {{sh.userName}}</a></span>
                            </div>
                            <video width="450" height="230" controls="controls" autoplay="autoplay">
                                <source :src="sh.shareAnnexUrl" type="video/mp4">
                            </video>
                        </div>

                        <!--音频动态-->
                        <div v-if="sh.songName != null">
                            <div class="s-music">
                                <div class="f-left">
                                    <a href="#">
                                        <img src="images/userPic.jpg" height="45">
                                        <img src="images/v-play.png" height="25" class="img-t">
                                    </a>
                                </div>
                                <div><a href="#"><h3 class="">{{sh.songName}}</h3></a></div>
                                <div><a href="#"><h4 class="">{{sh.singerName}}</h4></a></div>

                            </div>
                            <div class=" z-0"><img :src="sh.shareAnnexUrl" height="189"></div>
                        </div>

                        <!--转发动态-->
                        <div class="zhuanFa" v-if="sh.shareList != null" v-for="(shSon,indexSon) in sh.shareList">
                            <div class="userPic f-left">
                                <a href="#">
                                    <img :src="shSon.userHeadUrl" height="45">
                                </a>
                            </div>
                            <div class="userShareFoward f-left font-14 f-c-6">
                                <div class="type">
                                    <a href="#" class="font-14">{{shSon.userName}}</a>
                                    <img src="images/V.png" height="11">
                                    <span>{{shSon.videoOrMusic}}</span>
                                </div>
                                <div class="time font-12">
                                    <a href="#">{{shSon.shareTime}}</a>
                                </div>
                                <div class="font-14 f-c-3 text" v-html="shSon.shareText"></div>

                                <!--视频动态---播放视频时-->
                                <div class="video" v-if="shSon.shareTitle != null">
                                    <div>
                                <span style="padding-left: 150px;"><i><img src="images/share.png" height="10px"></i><a
                                        href="#">{{shSon.shareTitle}}</a><a href="#"
                                                                            class="font-12"
                                                                            style="color:#aaa;"> - by {{shSon.userName}}</a></span>
                                    </div>
                                    <video width="450" height="250" controls="controls" autoplay="autoplay">
                                        <source :src="shSon.shareAnnexUrl" type="video/mp4">
                                    </video>
                                </div>

                                <!--音频动态-->
                                <div v-if="shSon.songName != null">
                                    <div class="s-music" >
                                        <div class="f-left">
                                            <a href="#">
                                                <img src="images/userPic.jpg" height="45">
                                                <img src="images/v-play.png" height="25" class="img-t">
                                            </a>
                                        </div>
                                        <div><a href="#"><h3 class="">{{shSon.songName}}</h3></a></div>
                                        <div><a href="#"><h4 class="">{{shSon.singerName}}</h4></a></div>

                                    </div>
                                    <div class=" z-0"><img :src="shSon.shareAnnexUrl" height="189"></div>
                                </div>

                                <div class="s-foot">
                                    <div class="f-left">
                                        <span><img src="images/location.png" height="14px"><i class="f-c-d">{{shSon.shareLocation}}</i></span>
                                    </div>
                                    <div class="f-right">
                                <span><a class="f-c-gold" @click="addSonLikes(index, indexSon)"><img
                                        src="images/thumbs.png"
                                        height="14px">(<i>{{shSon.shareLikes}}</i>)</a></span>
                                        <span class="line f-c-gold">|</span>
                                        <span><a
                                                 class="f-c-gold" @click="shareForwardDivShow">转发(<i>{{shSon.shareForwardCount}}</i>)<i class="xiaoshi">{{shSon.shareId}}</i></a></span>
                                        <span class="line f-c-gold">|</span>
                                        <span><a href="#"
                                                 class="f-c-gold">评论(<i>{{shSon.shareCommentCount}}</i>)</a></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="s-foot">
                            <div class="f-left">
                                <span><img src="images/location.png" height="14px"><i
                                        class="f-c-d">{{sh.shareLocation}}</i></span>
                            </div>
                            <div class="f-right">
                                <span><a class="f-c-gold" @click="addLikes(index)"><img src="images/thumbs.png"
                                                                                        height="14px">(<i>{{sh.shareLikes}}</i>)</a></span>
                                <span class="line f-c-gold shareOtherBtn">|</span>
                                <span><a class="f-c-gold" @click="shareForwardDivShow(index)">转发(<i>{{sh.shareForwardCount}}</i>)<i class="xiaoshi">{{sh.shareId}}</i></a></span>
                                <span class="line f-c-gold">|</span>
                                <span><a href="#" class="f-c-gold">评论(<i>{{sh.shareCommentCount}}</i>)</a></span>
                            </div>
                        </div>
                    </div>

                </li>

            </ul>
        </div>
    </div>
    <div id="mB-right" class="f-right">
        <!--用户-->
        <div class="user">
            <div class="userPic">
                <a href="#" id="face">
                    <img src="images/userPic.jpg" height="70">
                </a>
                <a class="font-14 userName">用户名</a>
            </div>
            <ul class="u-fans">
                <li class="f-left">
                    <a href="#">
                        <em>1</em>
                        <i>动态</i>
                    </a>
                </li>
                <li class="f-left">
                    <a href="#">
                        <em>1</em>
                        <i>关注</i>
                    </a>
                </li>
                <li class="f-left">
                    <a href="#">
                        <em>1</em>
                        <i>粉丝</i>
                    </a>
                </li>


            </ul>

        </div>
        <!--其他用户-->
        <div class="otherUser">
            <div class="starUser"><i class="font-12 f-w-b">明星用户</i><i class="f-right"><a class="font-12"
                                                                                         href="#">换一批</a></i></div>
            <div class="otherUser-div">
                <div class="userPic f-left">
                    <a href="#">
                        <img src="images/userPic.jpg" height="45">
                    </a>
                </div>
                <div class=" f-left font-14 f-c-6 otherUsername">
                    <div class="type">
                        <a href="#" class="font-14" style="color: black">用户名</a>
                        <img src="images/V.png" height="11">
                    </div>
                    <div class="time font-12 ">
                        <a href="#">唱作歌手</a>
                    </div>
                    <div>
                        <a href="#" class="btn awh f-right"><i><img src="images/plus.png" height="12px"></i>关注</a>
                    </div>
                </div>
            </div>
            <div class="otherUser-div">
                <div class="userPic f-left">
                    <a href="#">
                        <img src="images/userPic.jpg" height="45">
                    </a>
                </div>
                <div class=" f-left font-14 f-c-6 otherUsername">
                    <div class="type">
                        <a href="#" class="font-14" style="color: black">用户名</a>
                        <img src="images/V.png" height="11">
                    </div>
                    <div class="time font-12 ">
                        <a href="#">唱作歌手</a>
                    </div>
                    <div>
                        <a href="#" class="btn awh f-right"><i><img src="images/plus.png" height="12px"></i>关注</a>
                    </div>
                </div>

            </div>
            <div class="otherUser-div">
                <div class="userPic f-left">
                    <a href="#">
                        <img src="images/userPic.jpg" height="45">
                    </a>
                </div>
                <div class=" f-left font-14 f-c-6 otherUsername">
                    <div class="type">
                        <a href="#" class="font-14" style="color: black">用户名</a>
                        <img src="images/V.png" height="11">
                    </div>
                    <div class="time font-12 ">
                        <a href="#">唱作歌手</a>
                    </div>
                    <div>
                        <a href="#" class="btn awh f-right"><i><img src="images/plus.png" height="12px"></i>关注</a>
                    </div>
                </div>

            </div>
            <div class="starUser"><i class="font-12 f-w-b">感兴趣的人</i><i class="f-right"><a class="font-12"
                                                                                          href="#">换一批</a></i></div>
            <div class="otherUser-div">
                <div class="userPic f-left">
                    <a href="#">
                        <img src="images/userPic.jpg" height="45">
                    </a>
                </div>
                <div class=" f-left font-14 f-c-6 otherUsername">
                    <div class="type">
                        <a href="#" class="font-14" style="color: black">用户名</a>
                        <img src="images/V.png" height="11">
                    </div>
                    <div class="time font-12 ">
                        <a href="#">唱作歌手</a>
                    </div>
                    <div>
                        <a href="#" class="btn awh f-right"><i><img src="images/plus.png" height="12px"></i>关注</a>
                    </div>
                </div>

            </div>
            <div class="otherUser-div">
                <div class="userPic f-left">
                    <a href="#">
                        <img src="images/userPic.jpg" height="45">
                    </a>
                </div>
                <div class=" f-left font-14 f-c-6 otherUsername">
                    <div class="type">
                        <a href="#" class="font-14" style="color: black">用户名</a>
                        <img src="images/V.png" height="11">
                    </div>
                    <div class="time font-12 ">
                        <a href="#">唱作歌手</a>
                    </div>
                    <div>
                        <a href="#" class="btn awh f-right"><i><img src="images/plus.png" height="12px"></i>关注</a>
                    </div>
                </div>

            </div>
            <div class="otherUser-div">
                <div class="userPic f-left">
                    <a href="#">
                        <img src="images/userPic.jpg" height="45">
                    </a>
                </div>
                <div class=" f-left font-14 f-c-6 otherUsername">
                    <div class="type">
                        <a href="#" class="font-14" style="color: black">用户名</a>
                        <img src="images/V.png" height="11">
                    </div>
                    <div class="time font-12 ">
                        <a href="#">唱作歌手</a>
                    </div>
                    <div>
                        <a href="#" class="btn awh f-right"><i><img src="images/plus.png" height="12px"></i>关注</a>
                    </div>
                </div>
            </div>
            <div><i class="font-12 f-w-b">添加微博好友，和他们分享音乐</i></div>
            <div>
                <i><img src="images/Weibo.png" height="20px" class="weibo"></i>
                <a href="#" class="btn xlwb f-right">绑定新浪微博</a>
            </div>


        </div>


    </div>

</div>
<a href="#" class="z-2 backTop btn"><i><img src="images/goup.png" height="10px"></i><br>Top</a>
</body>
</html>